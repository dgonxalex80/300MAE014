---
title: <span style="color:#034a94">**Estimación**</span>
subtitle: "Unidad "
author: "dgonzalez80"
date: ""
output:
  html_document:
    toc: no
    toc_depth: 2
    toc_float: yes
    code_folding: hide
    css: style.css
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, comment = NA)
library(psych)
library(summarytools)

# install.packages("devtools")
# devtools::install_github("dgonxalex80/paqueteDEG")
library(paqueteDEG)

# colores
c0= "#F7AA00"
c1= "#235784"
c2= "#40A8C4"
c3= "#EEF6F7"

c4= "#11224D"
c5= "#5B84C4"


```

<br/><br/>

# **Estimación por intervalos de confianza**


```{r, echo=FALSE, out.width="30%", fig.align = "center"}
# knitr::include_graphics("img/enconstruccion.gif")
```


```{r, echo=FALSE, out.width="20%", fig.align = "center"}
knitr::include_graphics("img/gic.png")
```




Un estimador por **intervalo de confianza** (IC) es una regla que especifica como usar las mediciones obtenidas en una muestra para calcular dos números que forman los extremos del intervalo que confiamos contenga al parámetro de interés $\theta$. Dependiendo del parámetro se utiliza en la construcción del IC las distribuciones muestrales:  

* $normal$ $estándar$ ($Z$), 
* $t-Student$, 
* $\chi^{2}$,  
* $F-Fisher$

<br/><br/>

## **Conceptos**

<br/>

### **Parámetro poblacional:** 

* Es el valor real que queremos estimar, pero que no conocemos con exactitud.

<br/>

### **Estimador:**

* Es una estadística muestral que se utiliza para estimar el parámetro poblacional.

<br/>

### **Intervalo de confianza:** 

* Es un rango de valores que tiene una alta probabilidad de contener el valor real del parámetro poblacional.

<br/>

### **Nivel de confianza:**

* Es la probabilidad de que el intervalo de confianza realmente contenga el valor real del parámetro poblacional. Se expresa como un porcentaje, como 95% o 99%.

<br/>

### **Error de estimación:** 

* Es la diferencia entre el valor real del parámetro poblacional y la estimación obtenida con el intervalo de confianza.

<br/>

### **Margen de error:** 

* Es la mitad del ancho del intervalo de confianza.

<br/>

### **Distribución muestral:**

* Es la distribución de los posibles valores del estimador, si se repitiera la muestra muchas veces.




<br/><br/><br/><br/>


## **Intervalos de confianza para la media, con varianza conocida** 

Partimos de dos valores que contiene el parámetro $\theta$

$$L_{I} \leq \theta \leq L_{S} $$

bajo el supuesto de que

$$Z=\frac{\bar{X}-\mu}{\sigma/\sqrt{n}} \sim N(0,1)$$

podemos construir el siguiente intervalo

$$P(L_{IC} \leq Z \leq L_{SC})=1-\alpha $$

donde $(1-\alpha)$ conforma el concepto de confianza, el cual difiere del concepto de probabilidad, en cuanto la confianza representa la proporción de intervalos que contienen el parámetro. Lo que significa que de 100 intervalos construidos a partir muestras aleatorias, $(1-\alpha)$% o más contendrán el parámetro. 

$$\begin{eqnarray*}
		P(-z_{\alpha/2} \leq Z \leq z_{\alpha/2})&=&1-\alpha \\
		P\Bigg(-z_{\alpha/2} \leq \frac{\bar{X}-\mu}{\sigma/\sqrt{n}} \leq z_{\alpha/2}\Bigg)&=&1-\alpha\\
		P\Bigg(\bar{X}-z_{\alpha/2}\frac{\sigma}{\sqrt{n}} \leq \mu \leq \bar{X}+z_{\alpha/2}\frac{\sigma}{\sqrt{n}}\Bigg)&=&1-\alpha \\
	\end{eqnarray*}$$
	
el intervalo de confianza para la media poblacional queda determinado por:

<div class="content-box-blue">

$$IC_{\mu}: \bar{x} \pm z_{\alpha/2} \hspace{.1cm}\dfrac{\sigma}{\sqrt{n}} $$

Supuestos:

* $X\sim N(\mu,\sigma^{2})$
*	varianza conocida

</div>
			
<br/><br/><br/>

## **Intervalo de confianza para la media, con varianza desconocida**
	
$$T=\dfrac{\bar{X}-\mu}{s/ \sqrt{n}}$$

se distribuye t student con $n-1$ grados de libertad y el intervalo se construye \\

$$\begin{eqnarray*}
		P\Big(-t_{\alpha/2} \leq T \leq t_{\alpha/2} \Big)&=&1-\alpha \\
		P\Big(-t_{\alpha/2} \leq \frac{\bar{X}-\mu}{s/\sqrt{n}} \leq t_{\alpha/2} \Big)&=&1-\alpha \\
		P\Bigg(\bar{X}-t_{\alpha/2} \dfrac{s}{\sqrt{n}} \leq \mu \leq \bar{X}+t_{\alpha/2}\dfrac{s}{\sqrt{n}}\Bigg)&=&1-\alpha \\
	\end{eqnarray*}$$

<div class="content-box-blue">

$$IC_{\mu}: \bar{x} \pm t_{\alpha/2} \hspace{.1cm}\frac{s}{\sqrt{n}} $$
			
Supuestos:

*	$X\sim N(\mu,\sigma^{2})$
* varianza desconocida

</div>

<br/><br/>

Cuando el tamaño de la muestra se considera grande (usualmente $n>30$) el estadístico T se aproxima a la distribución normal estandar, en este caso el intervalo de confianza se puede construir a a partir de:

<div class="content-box-blue">

$$IC_{\mu}: \bar{x} \pm z_{\alpha/2} \hspace{.1cm}\dfrac{s}{\sqrt{n}} $$

Supuestos:

* $X\sim N(\mu,\sigma^{2})$
* varianza desconocida

</div>

<br/><br/><br/>

|    |                                     |
|:--:|:------------------------------------|
| ![](img/ej1.png){width=120%} | Se registró el tiempo transcurrido entre la facturación y la recepción del pago, para una muestra de 100 clientes en una empresa. La media y la desviación estándar son respectivamente: 39.1 días y 17.3 días. Con el fin de establecer una medición de la calidad en el servicio, se requiere determinar una estimación del 95% para la media.|


Este caso tambien se utiliza cuando se desconoce la distribución de la variable X. En este caso se utiliza el teorema central del límite que aproxima la distribución de la media muestral a la distribución normal
<br/><br/>

**Solución** 

La estimación del tiempo que demora el pago de una factura es un valor de importancia tanto para empresarios como para proveedores, pues esta información se utiliza para la programación de gastos e ingresos. El problema nos suministra la siguiente información:

* $\bar{x}=39.1$ días
* $s=17.3$ días, lo que significa que se desconoce la varianza
* $n=100$ que se considera grande
* se requiere construir un IC del 95\% para $\mu$, que implica un valor del percentil $z=\pm 1.96$

$$\bar{x} \pm z_{\alpha/2} \frac{s}{\sqrt{n}} $$

$$39.1 \pm 1.96 \frac{17.3}{\sqrt{100}} $$

$$\Bigg(39.1 -1.96 \frac{17.3}{\sqrt{100}};39.1 + 1.96 \frac{17.3}{\sqrt{100}}\Bigg)$$

$$(35.71; 42.49 )$$

El tiempo promedio transcurrido entre la facturación y el pago en la empresa está entre 35.7 dias y 42.5 dias con una confianza del 95% 

<br/><br/><br/>

## **Tamaño de la muestra para estimar una media**

Uno de los problemas más frecuentes a los que nos enfrentamos es la determinación del tamaño de la muestra para realizar una estimación de la media que garantice una confianza del $(1-\alpha)\%$

$$P\Bigg(-z_{\alpha/2}\frac{\sigma}{\sqrt{n}} \leq \bar{X}-\mu \leq z_{\alpha/2}\frac{\sigma}{\sqrt{n}}\Bigg)=1-\alpha$$

Para construirlo partimos del supuesto que podemos tolerar un error de muestreo
$$e = \vert\bar{x}-\mu\vert \leq z_{\alpha/2}\frac{\sigma}{\sqrt{n}}$$

y que deseamos una con fiabilidad del $(1-\alpha)\%$.

Entonce podemos tener la confianza del $(1-\alpha)\%$ de que el error no exceda $z_{\alpha/2} \frac{\sigma}{\sqrt{n}}$ 	de la siguiente igualdad despejamos $n$

$$e= z_{\alpha/2} \frac{\sigma}{\sqrt{n}}$$

$$e^{2}= z_{\alpha/2}^{2} \frac{\sigma^{2}}{n}$$

$$n = \displaystyle\frac{z_{\alpha/2}^{2}\sigma^{2}}{e^{2}}$$
<br/><br/><br/>
			
|    |                                     |
|:--:|:------------------------------------|
| ![](img/ej2.png){width=120%} | Se desea estimar la media de las personas que han fallecido por Covid19 en Colombia, con una confianza del 98% y un error de muestreo de 1 persona . ¿Qué tamaño deberá tener la muestra para cumplir con estas condiciones?

<br/><br/>

**Solución**

Información:
Confianza  : 98%  ($z_{\alpha/2}$)
error de muestro : 3 una personas ($|\bar{x}-\mu| < e$)
varianza : no tenemos la varianza y por tanto tenemos 3 alternativas :(1) mediante un estudio previo similar obtener el valor de la varianza,  (2) realizar una muestra piloto  que puede ser de n=40 y con ella estimar la varianza $s^{2}$, (3) preguntando a un experto sobre el valor del mínimo y el máximo de la variable se puede estimar la desviación estándar 
$$s=\frac{\max\{x\}-\min\{x\}}{2}$$   

```{r}
# varianza
# s2.nota=var(sample(Colombia$edad, 100))
s2.nota =352.2395
# confianza : 1-a
a=1-.98
# error de nuestre
e=3 # personas 

# tamaño de muestra
n=paqueteDEG::sizemu(qnorm(1-a/2),s2.nota,e)
round(n,0)  # redondeo a entero


```



<br/><br/><br/>

## **Intervalos de confianza para la proporción** 

La construcción del intervalo de confianza para una proporción es similar al proceso realizado en la construcción de la media, bajo el supuesto de $np>10$ que permite la aproximación a una distribución normal

$$\widehat{p} \sim N\Bigg(p, \frac{p(1-p)}{n}\Bigg)$$

por tanto

$$\Bigg[ \hspace{.3cm} ^\widehat{p}-z_{\alpha/2}\sqrt{\frac{\widehat{p}\hspace{.1cm}(1-\widehat{p}}{n}} \hspace{.2cm};\hspace{.2cm} \widehat{p}+z_{\alpha/2}\sqrt{\frac{\widehat{p}\hspace{.1cm}(1-\widehat{p}}{n}} \hspace{.3cm} \Bigg] $$

<div class="content-box-blue">

$$IC_{p}: \widehat{p} \pm z_{\alpha/2} \hspace{.1cm}\sqrt{\frac{\widehat{p}(1-\widehat{p})}{n}}$$

Supuesto:

* $np>5$ o $n(1-p)>5$

</div>

<br/><br/><br/>	

|    |                                     |
|:--:|:------------------------------------|
| ![](img/ej3.png){width=120%} | En una encuesta aleatoria realizada a 500 familias de la ciudad que poseen televisión por cable,  se encuentra que 340 tienen suscripción a HBO.  Calcule un intervalo de confianza para la proporción de familias que tienen suscripción a HBO en la ciudad. Interprete el resultado obtenido.

<br/><br/>

**Solución** 

```{r}
prop.test(340,500)$conf.int
```


De acuerdo con el resultado anterior, se puede afirmar con una confianza del 95% que entre el 63.7% y el 72.0% de las familias tienen una suscripción a HBO


<br/><br/><br/>


## **Tamaño de muestra para la estimación de una proporción**

$$n=\dfrac{z_{\alpha/2}^{2}\hspace{.3cm} p(1-p)}{e^{2}}$$
Donde :

+ $z_{\alpha/2}$ : representa el percentil de la distribución normal relacionado con la confianza

+ $p$ : la proporción y p(1-p) la varianza.  Para conocerla se puede hacer uso de una estimación a través de una prueba piloto, la varianza máxima que ocurre cuando $p=0.5$  ($pq=0.25$)

+ $e$ : el error de muestreo que representa la tolerancia al erro que tiene el investigador ($|\widehat{p}-p|<e$).

<br/><br/><br/>

|    |                                     |
|:--:|:------------------------------------|
| ![](img/ej4.png){width=120%} | Una empresa requiere realizar un estudio para establecer las proporción de fallas diarias que presta la empresa al presentar un servicio . El gerente encargado del estudio decide que la tasa de error máximo tolerable debe ser del 5% y el nivel de confianza del 99% . Con esta información una firma de consultora presenta una propuesta a la empresa por valor de \$ 110.2 millones para realizar el estudio y justifica su costo así: Por costos administrativos y de logística corresponde un valor de \$ 55.4 millones y cada encuesta realizada tiene un valor de $50 mil pesos. El Director de la empresa le encarga a usted revisar la información darle un concepto sobre la propuesta realizada por la firma de auditores a la mayor brevedad

<br/><br/>

**Solución**

Información de la solicitud: 

* Objetivo : Analizar la propuesta realizada por la firma externa
  + Valor total : 110.2 millones
  + Valor costos administrativos y logísticos : 25.4 millones
  + Valor encuestas : 110.2-55.4 = 54.8 millones
  + Número de encuestas propuestas a realizar : 1096
  + nivel de confianza 99%
  + error de muestreo 0.05
  
```{r}
library(paqueteDEG)
paqueteDEG::sizep(qnorm(0.995),0.5,0.05)
```
De acuerdo con la información sumunistrada por la empresa, el tamaño de muestra apropiado para la estimación de la proporción, suponiendo varianza máxima es de $n=664$, por tal razón la propuesta realiza por la empresa consultora excede en   432 encuesta que presentan un sobre costo de \$21.6 millones
  
<br/><br/><br/>

## **Intervalos de confianza para la varianza** 

En el caso del intervalo de confianza para la varianza se parte de la premisa de que la variable

$$\frac{(n-1)S^{2}}{\sigma^{2}} \sim \chi^{2}_{v=n-1}$$

a partir de ella se puede construir

$$P\Bigg(\chi^{2}_{1-\alpha/2} \leq \frac{(n-1)S^{2}}{\sigma^{2}} \leq \chi^{2}_{\alpha/2} \Bigg)=1-\alpha$$

al invertir esta ecuaciones tenemos
$$P\Bigg(\frac{1}{\chi^{2}_{1-\alpha/2}} \geq \frac{\sigma^{2}}{(n-1)S^{2}} \geq \frac{1}{\chi^{2}_{\alpha/2}} \Bigg)=1-\alpha$$

finalmente tenemos

$$P\Bigg( \frac{(n-1)S^{2}}{\chi^{2}_{\alpha/2}} \leq \sigma^{2} \leq \frac{(n-1)S^{2}}{\chi^{2}_{1-\alpha/2}} \Bigg)=1-\alpha$$

<div class="content-box-blue">

$$IC_{\sigma^{2}}: \Bigg( \displaystyle\frac{(n-1)S^{2}}{\chi^{2}_{1-\alpha/2 ; v=n-1}} ;\displaystyle\frac{(n-1)S^{2}}{\chi^{2}_{\alpha/2; v=n-1}} \Bigg)$$

Supuestos:

* $X\sim N(\mu,\sigma^{2})$

</div>

<br/><br/><br/>

|    |                                     |
|:--:|:------------------------------------|
| ![](img/ej5.png){width=120%} | Se quiere estimar un intervalo de confianza del 95% para la desviación estandar de los precios de los últimos 22 dias (sep.10.2021 a oct.7.2021, tomados de :Investing.com)

<br/><br/>

```{r}
ecopetrol=c(2810, 2810,	2825, 2769, 2734, 2706,	2699, 2671, 2550, 2590,	2570, 2529,	2520, 2566,	2615, 2620, 2550, 2572,	2553, 2570,	2593, 2606)	

cat("IC_var :", paqueteDEG::intervalo.var(ecopetrol),"\n")  # intervalo de confianza para la varianza
cat("IC_sd :",sqrt(paqueteDEG::intervalo.var(ecopetrol)))# intervalo de confianza para la desviación estandar
```
<br/><br/>

Se estima con una confianza del 95% que la desviación estándar del precio de las acciones de Ecopetrol está entre \$ 75.7 y \$ 140.0 


<br/><br/><br/><br/>

## **Formulario**

|   |**parámetro** |**Estimador por IC **                                                     | **Supuestos** |
|:-:|:------------:|:------------------------------------------------------------------------:|:---------------------:|
|(1)| $\mu$         |$\bar{x} \pm z_{\alpha/2} \hspace{.1cm}\dfrac{\sigma}{\sqrt{n}}$         |$X\sim norm(\mu, \sigma^{2})$,$\sigma^{2}$ conocida|
|(2)|               |$\bar{x} \pm z_{\alpha/2} \hspace{.1cm}\dfrac{s}{\sqrt{n}}$              |$n>>$, TCL |
|(3)|              |$\bar{x} \pm t_{\frac{\alpha}{2};v=n-1} \hspace{.1cm}\dfrac{s}{\sqrt{n}}$ |$X\sim norm(\mu, \sigma^{2})$, $\sigma^{2}$ desconocida|
|(4)|$p$           |$\widehat{p}\pm z_{\frac{\alpha}{2}} \sqrt{\frac{\widehat{p}(1-\widehat{p})}{n}}$| $n>>$|
|(5) |$\sigma^{2}$  |$\Bigg( \dfrac{(n-1)s^{2}}{\chi^{2}_{1-\alpha/2}} ;\dfrac{(n-1)s^{2}}{\chi^{2}_{\alpha/2}} \Bigg)$ | $X\sim norm(\mu, \sigma^{2})$|




<br/><br/><br/><br/>

# **Videos**


## **Intervalos de confianza**

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
# Copia y pega el enlace del video de YouTube aquí:
url <- "https://www.youtube.com/embed/5y7MJiPXIjw"

# Incrusta el video en una ventana de 800x450:
cat(sprintf('<iframe width="%s" height="%s" src="%s" frameborder="0" allowfullscreen></iframe>',
            800, 450, url))

```


<br/><br/><br/><br/>

# **Tamaño de muestra**                                                            

<br/><br/>

### $\mu$  

$$n=\dfrac{z_{\alpha/2}^{2}\hspace{.3cm} \sigma^{2}}{e^{2}}$$                   
Donde: 

* $z_{\alpha/2}$ : Percentil($1-\alpha/2$) normal;

* $\sigma^{2}$: varianza, que se puede obtener mediante prueba piloto, conocer de un estudio anterior, o estimar mediante consulta a un experto : $\widehat{\sigma}  \cong  (\max\{x\}-\min\{x\})/4$ y 

* $e$ : error de muestreo $(|\bar{x}-\mu|< e)$.    

<br/><br/>

### $p$

$$n=\dfrac{z_{\alpha/2}^{2}\hspace{.3cm} pq }{e^{2}}$$

Donde: 

* $z_{\alpha/2}$ : Percentil($1-\alpha/2$) normal; 

* $pq$: varianza, que se puede obtener mediante prueba piloto, conocer de un estudio anterior, o se puede asumir como varianza máxima $pq=0.5(1-0.5)=0.25$ 

* $e$ : error de muestreo $(|\widehat{p}-p|< e)$.     

<br/><br/><br/>

En todos los casos si n/N>0.05, debes de corregir por un factor de población finita

$$n = \dfrac{N n_{0}}{N+n_{0}-1}$$


<br/><br/><br/><br/>



![](img/R.png){width=10%}

| parámetro        | código R                                                |
|:----------------:|:--------------------------------------------------------|
|$\mu$             | `t.test(x, coef.level= 1−a)$conf.int`                   |
|$p$               | `prop.test(x,n, conf.level=0.95)$conf.int`              |
|$n_{\mu}$         | `paqueteDEG::sizemu(1.96,345,2)     # sizemu(z,sigma2,error)`|
|$n_{p}$           | `paqueteDEG::sizep(1.96,0.5,0.05)   # sizep(z,prob,error)`   |
|$n = \dfrac{(n_{o} \hspace{.1cm} N)}{(n_{o} + N - 1)}$ | `paqueteDEG::adjusted_size(385,2000) # adjusted_size(n,N)`   |









